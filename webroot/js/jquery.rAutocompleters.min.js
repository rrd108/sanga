$.rAutocompleteCacheName="rAutocompleteCache",$.createAutocompleters=function(e,a){function t(e){var a=e.attr("id").replace("ac-","");e.data("selectedId")&&$("#"+a).val(e.data("selectedId"))}a=$.extend({cacheName:$.rAutocompleteCacheName,baseUrl:"",notFoundMessage:"Nothing found",onlyExistingValue:!0},a);var l=function(){var e=$(this),l=e.val();if(l&&-1==l.indexOf(" ")){var o=e.data("ac")+"/"+l,c=$.localStorage(a.cacheName+"."+o);c?(e.val(c[0].label),e.data("selectedId",c[0].value),t(e)):(e.addClass("loading"),$(':input[data-type="submit"]').prop("disabled",!0),$.ajax({dataType:"json",url:a.baseUrl+e.data("ac")+"?term="+l,success:function(l){e.removeClass("loading"),l[0]?($.localStorage(a.cacheName+"."+o,l),e.val(l[0].label),e.data("selectedId",l[0].value),t(e),$(':input[data-type="submit"]').prop("disabled",!1)):a.onlyExistingValue&&(e.effect("shake"),e.val("???"),noty({layout:"topRight",type:"error",timeout:5e3,closeWith:["click"],text:a.notFoundMessage}))}}))}else t(e)};$.createAutocompleters.blurHandler=l;var o=$("#"+e+" input[data-ac]");o.each(function(){var e=$(this).attr("id"),t=e.replace(/-/,"_");$(this).attr("id","ac-"+e),$(this).attr("name","ac-"+t),$(this).attr("autocomplete","off");var o='<input name="'+t+'" id="'+e+'" value="'+$(this).val()+'" type="hidden">';$(this).after(o),$(this).val($(this).data("val")),$(this).autocomplete($.autocompletefactory({url:a.baseUrl+$(this).data("ac"),cacheName:a.cacheName,notFoundMessage:a.notFoundMessage})),$(this).blur(l)}),$("body").append('<div id="rAutocompleterDialog"></div>'),$("#rAutocompleterDialog").dialog({autoOpen:!1,width:500}),$("#rAutocompleterDialog").on("click",function(e){var a=$(e.target).data("target");a.replace("ac-","");$("#"+a).val($(e.target).text()),$("#"+a).data("selectedId",$(e.target).data("id")),$("#rAutocompleterDialog").dialog("close")})},$.autocompletefactory=function(e){var a=$.extend({resultCount:5,minLength:2},e);if(a.cacheName&&($.rAutocompleteCacheName=a.cacheName),!a.url)throw new Error("autocompelete factory called without url parameter");null===$.localStorage(a.cacheName)&&$.localStorage(a.cacheName,{});var t=new Date;return $.localStorage(a.cacheName+".time")&&$.localStorage(a.cacheName+".time")<t-432e5&&$.localStorage.remove(a.cacheName),$.localStorage(a.cacheName,{time:t.getTime()}),{resultCount:a.resultCount,minLength:a.minLength,source:function(t,l){var o,c=a.url+"/"+t.term;if(c in $.localStorage(a.cacheName)?o=$.localStorage(a.cacheName)[c]:$.ajax({async:!1,dataType:"json",url:a.url,data:t,success:function(e,t,l){0!=e.length&&$.localStorage(a.cacheName+"."+c,e),o=e}}),0==o.length)return l({label:e.notFoundMessage,value:-1}),!1;-1==t.term.indexOf("*")&&o.push({label:t.term+" *",value:0}),l(o),$(this.element).data("selectedId",o[0].value)},open:function(e,a){-1==$(this).val().indexOf("*")&&$(".ui-autocomplete li:last div").html('<i class="fi-magnifying-glass"> '+$(this).val()+" * </i>")},focus:function(e,a){$(this).val(a.item.label),$(this).data("selectedId",a.item.value),e.preventDefault()},select:function(e,t){$(this).val(t.item.label),$(this).data("selectedId",t.item.value),0===t.item.value&&$.ajax({dataType:"json",url:a.url,data:{term:t.item.label.replace(" *",""),limit:50},input:$(this),success:function(e){$("#rAutocompleterDialog").dialog("option","title",t.item.label);var a=this.input.attr("id");$.each(e,function(e,t){$("#rAutocompleterDialog").append('<li data-id="'+t.value+'" data-target="'+a+'">'+t.label+"</li>")}),$("#rAutocompleterDialog").dialog("open")}}),e.preventDefault()}}};